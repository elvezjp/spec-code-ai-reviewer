# バージョン切替用 map 設定
# 新バージョン追加時はここを更新

# Cookie値に応じてバックエンドポートを振り分け
map $cookie_app_version $backend_port {
    "v0.7.0"  8070;
    "v0.6.0"  8060;
    "v0.5.2"  8052;
    "v0.5.1"  8051;
    "v0.5.0"  8050;
    default   8070;  # latest (v0.7.0)
}

# Cookie値に応じてフロントエンドを振り分け
# v0.6.0以降はViteビルド済みのdistをマウント先として参照
# latestシンボリックリンクは使用せず、最新バージョンを直接指定
map $cookie_app_version $frontend_root {
    "v0.7.0"  /var/www/spec-code-ai-reviewer/versions/v0.7.0/frontend;
    "v0.6.0"  /var/www/spec-code-ai-reviewer/versions/v0.6.0/frontend;
    "v0.5.2"  /var/www/spec-code-ai-reviewer/versions/v0.5.2/frontend;
    "v0.5.1"  /var/www/spec-code-ai-reviewer/versions/v0.5.1/frontend;
    "v0.5.0"  /var/www/spec-code-ai-reviewer/versions/v0.5.0/frontend;
    default   /var/www/spec-code-ai-reviewer/versions/v0.7.0/frontend;  # latest (v0.7.0)
}

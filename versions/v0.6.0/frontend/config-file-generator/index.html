<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ« */
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }

    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
    .radio-option {
      display: inline-flex;
      align-items: center;
      padding: 8px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .radio-option:hover {
      border-color: #93c5fd;
      background: #eff6ff;
    }

    .radio-option.selected {
      border-color: #3b82f6;
      background: #eff6ff;
    }

    .radio-option input[type="radio"] {
      margin-right: 8px;
    }

  </style>
</head>
<body class="bg-gray-100 min-h-screen">

<script>
// ====================
// ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
// ====================
const SCHEMA = {
  meta: {
    outputTitle: "è¨­è¨ˆæ›¸-Javaãƒ—ãƒ­ã‚°ãƒ©ãƒ çªåˆ AIãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«",
    outputFileName: "reviewer-config.md",
    version: "v0.5.2"
  },
  sections: [
    {
      id: "info",
      title: "info",
      description: "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±",
      outputFormat: "list",
      fields: [
        {
          id: "version",
          label: "version",
          type: "fixed",
          value: "v0.5.2"
        },
        {
          id: "created_at",
          label: "created_at",
          type: "auto",
          generator: "timestamp_iso8601"
        }
      ]
    },
    {
      id: "llm",
      title: "llm",
      description: "LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š",
      outputFormat: "list",
      conditional: {
        switchField: "provider",
        cases: {
          anthropic: {
            fields: [
              { id: "provider", type: "fixed", value: "anthropic" },
              { id: "apiKey", label: "API Key", type: "password", required: true },
              { id: "maxTokens", label: "Max Tokens", type: "number", default: 16384, required: true },
              {
                id: "models",
                label: "ãƒ¢ãƒ‡ãƒ«",
                type: "array",
                itemType: "text",
                placeholder: "claude-sonnet-4-5-20250929",
                defaults: ["claude-sonnet-4-5-20250929", "claude-haiku-4-5-20251001"]
              }
            ]
          },
          bedrock: {
            notes: [
              "ãƒ¢ãƒ‡ãƒ«IDã«ã¯ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆä¾‹: us., apac., global.ï¼‰ãŒå¿…è¦ã§ã™ã€‚",
              "ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦è¨­å®šå¯èƒ½ãªå‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³ä¸Šé™ãŒç•°ãªã‚Šã¾ã™ï¼ˆä¾‹: Novaç³»ã¯10,000ã€Claudeç³»ã¯æœ€å¤§128,000ï¼‰ã€‚",
              "è¨­å®šå¯èƒ½ãªä¸Šé™å€¤ã‚’è¶…ãˆãŸå‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’æŒ‡å®šã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚"
            ],
            fields: [
              { id: "provider", type: "fixed", value: "bedrock" },
              { id: "accessKeyId", label: "Access Key ID", type: "password", required: true },
              { id: "secretAccessKey", label: "Secret Access Key", type: "password", required: true },
              { id: "region", label: "Region", type: "text", default: "ap-northeast-1", required: true },
              { id: "maxTokens", label: "Max Tokens", type: "number", default: 10000, required: true },
              {
                id: "models",
                label: "ãƒ¢ãƒ‡ãƒ«",
                type: "array",
                itemType: "text",
                placeholder: "global.anthropic.claude-haiku-4-5-20251001-v1:0",
                defaults: [
                  "global.anthropic.claude-haiku-4-5-20251001-v1:0",
                  "global.anthropic.claude-sonnet-4-5-20250929-v1:0",
                  "apac.amazon.nova-pro-v1:0",
                  "apac.amazon.nova-micro-v1:0"
                ]
              }
            ]
          },
          openai: {
            fields: [
              { id: "provider", type: "fixed", value: "openai" },
              { id: "apiKey", label: "API Key", type: "password", required: true },
              { id: "maxTokens", label: "Max Tokens", type: "number", default: 16384, required: true },
              {
                id: "models",
                label: "ãƒ¢ãƒ‡ãƒ«",
                type: "array",
                itemType: "text",
                placeholder: "gpt-5.2",
                defaults: [
                  "gpt-5.2",
                  "gpt-5.2-chat-latest",
                  "gpt-5.2-pro",
                  "gpt-5.1",
                  "gpt-4o",
                  "gpt-4o-mini"
                ]
              }
            ]
          }
        }
      }
    },
    {
      id: "specTypes",
      title: "specTypes",
      description: "è¨­è¨ˆæ›¸ç¨®åˆ¥",
      outputFormat: "table",
      columns: [
        { id: "type", label: "ç¨®åˆ¥", type: "text", width: "30%" },
        { id: "note", label: "æ³¨æ„äº‹é …", type: "text", width: "70%" }
      ],
      defaults: [
        { type: "è¨­è¨ˆæ›¸", note: "æ©Ÿèƒ½ä»•æ§˜ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "è¦ä»¶å®šç¾©æ›¸", note: "è¦ä»¶ãŒæ¼ã‚Œãªãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯", note: "å‡¦ç†æ‰‹é †ã‚„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "å‡¦ç†ãƒ•ãƒ­ãƒ¼", note: "å‡¦ç†ã®æµã‚ŒãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„", note: "ã‚³ãƒ¼ãƒ‰ãŒã“ã®è¦ç´„ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "ãƒãƒ¼ãƒŸãƒ³ã‚°ãƒ«ãƒ¼ãƒ«", note: "å‘½åè¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "è£½é€ ã‚¬ã‚¤ãƒ‰", note: "ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "è¨­è¨ˆã‚¬ã‚¤ãƒ‰", note: "ã“ã®è¨­è¨ˆæ–¹é‡ã«å¾“ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" },
        { type: "è¨­è¨ˆæ›¸ã¨ã‚½ãƒ¼ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚°", note: "ã“ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«åŸºã¥ã„ã¦çªåˆã‚’è¡Œã£ã¦ãã ã•ã„" }
      ],
      editable: true,
      minRows: 0
    },
    {
      id: "systemPrompts",
      title: "systemPrompts",
      description: "ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©",
      outputFormat: "sections",
      itemKey: "name",
      fields: [
        { id: "name", label: "ãƒ—ãƒªã‚»ãƒƒãƒˆå" },
        { id: "role", label: "å½¹å‰²", rows: 2 },
        { id: "purpose", label: "ç›®çš„", rows: 6 },
        { id: "format", label: "ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ", rows: 4 },
        { id: "notes", label: "æ³¨æ„äº‹é …", rows: 6 }
      ],
      defaults: [
        {
          name: "æ¨™æº–ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒªã‚»ãƒƒãƒˆ",
          role: "ã‚ãªãŸã¯è¨­è¨ˆæ›¸ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚³ãƒ¼ãƒ‰ã‚’çªåˆã—ã€æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã§ã™ã€‚",
          purpose: "è¨­è¨ˆæ›¸ã®å†…å®¹ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã—ã€å·®ç•°ã‚„å•é¡Œç‚¹ã‚’å ±å‘Šã—ã¦ãã ã•ã„ã€‚\n\nä»¥ä¸‹ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã£ã¦ãã ã•ã„ï¼š\n1. æ©Ÿèƒ½ç¶²ç¾…æ€§: è¨­è¨ˆæ›¸ã«è¨˜è¼‰ã•ã‚ŒãŸæ©Ÿèƒ½ãŒã‚³ãƒ¼ãƒ‰ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹\n2. ä»•æ§˜æ•´åˆæ€§: é–¢æ•°åãƒ»å¤‰æ•°åãƒ»ãƒ‡ãƒ¼ã‚¿å‹ãƒ»å‡¦ç†ãƒ•ãƒ­ãƒ¼ãŒè¨­è¨ˆæ›¸ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹\n3. ã‚¨ãƒ©ãƒ¼å‡¦ç†: è¨­è¨ˆæ›¸ã«è¨˜è¼‰ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹\n4. å¢ƒç•Œå€¤ãƒ»åˆ¶ç´„: è¨­è¨ˆæ›¸ã«è¨˜è¼‰ã•ã‚ŒãŸåˆ¶ç´„æ¡ä»¶ãŒã‚³ãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹",
          format: "ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§ã€ä»¥ä¸‹ã®é †ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š\n1. ã‚µãƒãƒªãƒ¼ï¼ˆçªåˆæ—¥æ™‚ã€ãƒ•ã‚¡ã‚¤ãƒ«åã€ç·åˆåˆ¤å®šï¼‰\n2. çªåˆçµæœä¸€è¦§ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼‰\n3. è©³ç´°ï¼ˆå•é¡Œç‚¹ã¨æ¨å¥¨äº‹é …ï¼‰",
          notes: "- ãƒ¡ã‚¤ãƒ³è¨­è¨ˆæ›¸ã®å†…å®¹ã«ã¤ã„ã¦çªåˆã—ã¦ãã ã•ã„ã€‚\n- åˆ¤å®šã¯ã€ŒOKã€ã€ŒNGã€ã€Œè¦ç¢ºèªã€ã®3æ®µéšã§è¡Œã£ã¦ãã ã•ã„\n- é‡è¦åº¦ãŒé«˜ã„å•é¡Œã‚’å„ªå…ˆã—ã¦å ±å‘Šã—ã¦ãã ã•ã„ã€‚\n- è¨­è¨ˆæ›¸ã‚’å¼•ç”¨ã™ã‚‹éš›ã¯ã€è¦‹å‡ºã—ç•ªå·ã‚„é …ç›®ç•ªå·ã‚’æ˜ç¤ºã—ã¦ãã ã•ã„ã€‚\n- ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¼•ç”¨ã™ã‚‹éš›ã¯ã€è¡Œç•ªå·ã‚’å¿…ãšæ·»ãˆã¦ãã ã•ã„ã€‚\n- å„è¨­è¨ˆæ›¸ã®å†’é ­ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å½¹å‰²ã€ç¨®åˆ¥ã€æ³¨æ„äº‹é …ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚\n- ãƒ¡ã‚¤ãƒ³ä»¥å¤–ã®è¨­è¨ˆæ›¸ã¯å¿…è¦ãªå ´åˆã«å‚ç…§ã—ã¦ãã ã•ã„ã€‚"
        }
      ],
      editable: true,
      minRows: 0
    }
  ]
};

// ====================
// çŠ¶æ…‹ç®¡ç†
// ====================
let formState = {
  provider: 'bedrock',
  llmFields: {},
  specTypes: [],
  systemPrompts: []
};

// ====================
// åˆæœŸåŒ–
// ====================
function init() {
  // specTypes ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
  const specTypesSection = SCHEMA.sections.find(s => s.id === 'specTypes');
  formState.specTypes = JSON.parse(JSON.stringify(specTypesSection.defaults));

  // systemPrompts ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
  const systemPromptsSection = SCHEMA.sections.find(s => s.id === 'systemPrompts');
  formState.systemPrompts = JSON.parse(JSON.stringify(systemPromptsSection.defaults));

  // LLMãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
  initLlmFields('bedrock');

  // UIã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  renderApp();
}

function initLlmFields(provider) {
  const llmSection = SCHEMA.sections.find(s => s.id === 'llm');
  const caseConfig = llmSection.conditional.cases[provider];

  formState.llmFields = {};
  caseConfig.fields.forEach(field => {
    if (field.type === 'array') {
      formState.llmFields[field.id] = [...field.defaults];
    } else if (field.default !== undefined) {
      formState.llmFields[field.id] = field.default;
    } else if (field.type === 'fixed') {
      formState.llmFields[field.id] = field.value;
    } else {
      formState.llmFields[field.id] = '';
    }
  });
}

// ====================
// ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
// ====================
function renderApp() {
  const container = document.getElementById('app');
  container.innerHTML = `
    <div class="max-w-4xl mx-auto p-6">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h1 class="text-xl font-bold text-gray-800 text-center mb-4">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        <p class="text-gray-600 text-sm text-center">
          ${SCHEMA.meta.outputTitle}ã‚’ä½œæˆã—ã¾ã™ã€‚<br>
          å„é …ç›®ã‚’å…¥åŠ›ã—ã¦ã€Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>
      </div>

      <!-- info ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      ${renderInfoSection()}

      <!-- llm ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      ${renderLlmSection()}

      <!-- specTypes ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      ${renderTableSection('specTypes')}

      <!-- systemPrompts ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      ${renderSectionsSection('systemPrompts')}

      <!-- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <button onclick="downloadConfig()" class="w-full py-4 bg-blue-500 hover:bg-blue-600 text-white text-lg font-bold rounded-lg transition flex items-center justify-center gap-3">
          <span class="text-2xl">ğŸ“¥</span>
          <span>${SCHEMA.meta.outputFileName} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
        </button>
      </div>
    </div>
  `;

  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
  setupEventListeners();
}

function renderInfoSection() {
  const section = SCHEMA.sections.find(s => s.id === 'info');

  return `
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-lg font-bold text-gray-800 mb-1">â–  ${section.title}</h2>
      <p class="text-sm text-gray-500 mb-4">${section.description}</p>

      <div class="space-y-3">
        ${section.fields.map(field => {
          if (field.type === 'fixed') {
            return `
              <div class="flex items-center">
                <label class="w-32 text-sm font-medium text-gray-700">${field.label}:</label>
                <span class="text-gray-600">${field.value}ï¼ˆå›ºå®šï¼‰</span>
              </div>
            `;
          } else if (field.type === 'auto') {
            return `
              <div class="flex items-center">
                <label class="w-32 text-sm font-medium text-gray-700">${field.label}:</label>
                <span class="text-gray-500 italic">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã«è‡ªå‹•ç”Ÿæˆ</span>
              </div>
            `;
          }
          return '';
        }).join('')}
      </div>
    </div>
  `;
}

function renderLlmSection() {
  const section = SCHEMA.sections.find(s => s.id === 'llm');
  const providers = Object.keys(section.conditional.cases);
  const currentCase = section.conditional.cases[formState.provider];

  return `
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-lg font-bold text-gray-800 mb-1">â–  ${section.title}</h2>
      <p class="text-sm text-gray-500 mb-4">${section.description}</p>

      <!-- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é¸æŠ -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼:</label>
        <div class="flex gap-3 flex-wrap">
          ${providers.map(p => `
            <label class="radio-option ${formState.provider === p ? 'selected' : ''}">
              <input type="radio" name="provider" value="${p}"
                ${formState.provider === p ? 'checked' : ''}
                onchange="handleProviderChange('${p}')">
              ${p.charAt(0).toUpperCase() + p.slice(1)}
            </label>
          `).join('')}
        </div>
      </div>

      <!-- æ³¨æ„äº‹é …ï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ï¼‰ -->
      ${currentCase.notes && currentCase.notes.length > 0 ? `
      <div class="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
        <div class="flex items-start gap-2">
          <span class="text-amber-600 text-lg">âš </span>
          <div>
            <p class="font-medium text-amber-800 mb-1">æ³¨æ„</p>
            <ul class="text-sm text-amber-700 space-y-1">
              ${currentCase.notes.map(note => `<li>â€¢ ${note}</li>`).join('')}
            </ul>
          </div>
        </div>
      </div>
      ` : ''}

      <!-- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
      <div id="llm-fields" class="space-y-4">
        ${currentCase.fields.filter(f => f.type !== 'fixed').map(field => renderLlmField(field)).join('')}
      </div>
    </div>
  `;
}

function renderLlmField(field) {
  const value = formState.llmFields[field.id];
  const requiredMark = field.required ? '<span class="text-red-500">*</span>' : '';

  if (field.type === 'password' || field.type === 'text') {
    return `
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">${field.label}: ${requiredMark}</label>
        <input type="${field.type}"
          id="llm-${field.id}"
          value="${value || ''}"
          placeholder="${field.placeholder || ''}"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          oninput="handleLlmFieldChange('${field.id}', this.value)">
        <div id="error-llm-${field.id}" class="text-red-500 text-sm mt-1 hidden"></div>
      </div>
    `;
  }

  if (field.type === 'number') {
    return `
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">${field.label}: ${requiredMark}</label>
        <input type="number"
          id="llm-${field.id}"
          value="${value}"
          ${field.min !== undefined ? `min="${field.min}"` : ''}
          ${field.max !== undefined ? `max="${field.max}"` : ''}
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          oninput="handleLlmFieldChange('${field.id}', parseInt(this.value) || 0)">
        <div id="error-llm-${field.id}" class="text-red-500 text-sm mt-1 hidden"></div>
      </div>
    `;
  }

  if (field.type === 'array') {
    const items = Array.isArray(value) ? value : [];
    return `
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">${field.label}:</label>
        <div id="array-${field.id}" class="space-y-2">
          ${items.map((item, index) => `
            <div class="flex items-center gap-2">
              <input type="text"
                value="${item}"
                placeholder="${field.placeholder || ''}"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                oninput="handleArrayItemChange('${field.id}', ${index}, this.value)">
              <button onclick="removeArrayItem('${field.id}', ${index})"
                class="text-red-500 hover:text-red-700 px-2 py-1 text-lg" title="å‰Šé™¤">Ã—</button>
            </div>
          `).join('')}
        </div>
        <button onclick="addArrayItem('${field.id}', '${field.placeholder || ''}')"
          class="mt-2 text-blue-500 hover:text-blue-700 text-sm flex items-center gap-1">
          <span>+</span> ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
        </button>
      </div>
    `;
  }

  return '';
}

function renderTableSection(sectionId) {
  const section = SCHEMA.sections.find(s => s.id === sectionId);
  const rows = formState[sectionId] || [];

  return `
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-lg font-bold text-gray-800 mb-1">â–  ${section.title}</h2>
      <p class="text-sm text-gray-500 mb-4">${section.description}</p>

      <div class="overflow-x-auto">
        <table class="w-full border-collapse table-fixed">
          <thead>
            <tr class="bg-gray-50">
              ${section.columns.map(col => `
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700 border border-gray-200" ${col.width ? `style="width: ${col.width}"` : ''}>${col.label}</th>
              `).join('')}
              <th class="w-10 border border-gray-200"></th>
            </tr>
          </thead>
          <tbody id="${sectionId}-body">
            ${rows.map((row, index) => renderTableRow(sectionId, row, index, section.columns)).join('')}
          </tbody>
        </table>
      </div>

      <button onclick="addTableRow('${sectionId}')"
        class="mt-3 text-blue-500 hover:text-blue-700 text-sm flex items-center gap-1">
        <span>+</span> è¡Œã‚’è¿½åŠ 
      </button>
    </div>
  `;
}

function renderTableRow(sectionId, row, index, columns) {
  return `
    <tr class="align-top">
      ${columns.map(col => {
        const value = row[col.id] || '';
        const escapedValue = escapeHtml(value);

        if (col.type === 'textarea') {
          return `
            <td class="border border-gray-200 p-0">
              <textarea
                rows="${col.rows || 3}"
                class="w-full px-4 py-2 border-0 focus:ring-2 focus:ring-blue-500 resize-y text-sm"
                oninput="handleTableRowChange('${sectionId}', ${index}, '${col.id}', this.value)">${escapedValue}</textarea>
            </td>
          `;
        } else {
          return `
            <td class="border border-gray-200 p-0">
              <input type="text"
                value="${escapedValue}"
                class="w-full px-4 py-2 border-0 focus:ring-2 focus:ring-blue-500"
                oninput="handleTableRowChange('${sectionId}', ${index}, '${col.id}', this.value)">
            </td>
          `;
        }
      }).join('')}
      <td class="border border-gray-200 text-center">
        <button onclick="removeTableRow('${sectionId}', ${index})"
          class="text-red-500 hover:text-red-700 px-2 py-1" title="å‰Šé™¤">Ã—</button>
      </td>
    </tr>
  `;
}

function renderSectionsSection(sectionId) {
  const section = SCHEMA.sections.find(s => s.id === sectionId);
  const items = formState[sectionId] || [];

  return `
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-lg font-bold text-gray-800 mb-1">â–  ${section.title}</h2>
      <p class="text-sm text-gray-500 mb-4">${section.description}</p>

      <div id="${sectionId}-items" class="space-y-4">
        ${items.map((item, index) => renderSectionItem(sectionId, item, index, section.fields)).join('')}
      </div>

      <button onclick="addSectionItem('${sectionId}')"
        class="mt-4 text-blue-500 hover:text-blue-700 text-sm flex items-center gap-1">
        <span>+</span> ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è¿½åŠ 
      </button>
    </div>
  `;
}

function renderSectionItem(sectionId, item, index, fields) {
  const nameField = fields.find(f => f.id === 'name');
  const otherFields = fields.filter(f => f.id !== 'name');
  const itemName = item.name || `ãƒ—ãƒªã‚»ãƒƒãƒˆ ${index + 1}`;

  return `
    <div class="border border-gray-200 rounded-lg overflow-hidden">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆåã¨å‰Šé™¤ãƒœã‚¿ãƒ³ï¼‰ -->
      <div class="bg-gray-50 px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3 flex-1">
          <button onclick="toggleSectionItem('${sectionId}', ${index})"
            class="text-gray-500 hover:text-gray-700 transition" id="${sectionId}-toggle-${index}">
            â–¼
          </button>
          <input type="text"
            value="${escapeHtml(item.name || '')}"
            placeholder="ãƒ—ãƒªã‚»ãƒƒãƒˆåã‚’å…¥åŠ›"
            class="flex-1 px-3 py-1 border border-gray-300 rounded-md text-sm font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            oninput="handleSectionItemChange('${sectionId}', ${index}, 'name', this.value)">
        </div>
        <button onclick="removeSectionItem('${sectionId}', ${index})"
          class="text-red-500 hover:text-red-700 px-2 py-1 text-lg ml-2" title="å‰Šé™¤">Ã—</button>
      </div>

      <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆå„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ -->
      <div id="${sectionId}-content-${index}" class="p-4 space-y-4">
        ${otherFields.map(field => `
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">${field.label}</label>
            <textarea
              rows="${field.rows || 3}"
              class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-y"
              oninput="handleSectionItemChange('${sectionId}', ${index}, '${field.id}', this.value)">${escapeHtml(item[field.id] || '')}</textarea>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function escapeHtml(text) {
  if (!text) return '';
  return String(text)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

function escapeForTableCell(text) {
  if (!text) return '';
  // æ”¹è¡Œã‚’<br>ã«å¤‰æ›ã—ã€ãƒ‘ã‚¤ãƒ—æ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
  return String(text)
    .replace(/\|/g, '\\|')
    .replace(/\n/g, '<br>');
}

// ====================
// ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
// ====================
function setupEventListeners() {
  // ç¾åœ¨ã¯è¿½åŠ ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãªã—
}

function handleProviderChange(provider) {
  formState.provider = provider;
  initLlmFields(provider);
  renderApp();
}

function handleLlmFieldChange(fieldId, value) {
  formState.llmFields[fieldId] = value;
}

function handleArrayItemChange(fieldId, index, value) {
  if (formState.llmFields[fieldId]) {
    formState.llmFields[fieldId][index] = value;
  }
}

function addArrayItem(fieldId, placeholder) {
  if (!formState.llmFields[fieldId]) {
    formState.llmFields[fieldId] = [];
  }
  formState.llmFields[fieldId].push('');
  renderApp();
}

function removeArrayItem(fieldId, index) {
  if (formState.llmFields[fieldId]) {
    formState.llmFields[fieldId].splice(index, 1);
    renderApp();
  }
}

function handleTableRowChange(sectionId, index, columnId, value) {
  if (formState[sectionId] && formState[sectionId][index]) {
    formState[sectionId][index][columnId] = value;
  }
}

function addTableRow(sectionId) {
  const section = SCHEMA.sections.find(s => s.id === sectionId);
  const newRow = {};
  section.columns.forEach(col => {
    newRow[col.id] = '';
  });
  formState[sectionId].push(newRow);
  renderApp();
}

function removeTableRow(sectionId, index) {
  if (formState[sectionId]) {
    formState[sectionId].splice(index, 1);
    renderApp();
  }
}

// ã‚»ã‚¯ã‚·ãƒ§ãƒ³å½¢å¼ç”¨ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
function handleSectionItemChange(sectionId, index, fieldId, value) {
  if (formState[sectionId] && formState[sectionId][index]) {
    formState[sectionId][index][fieldId] = value;
  }
}

function addSectionItem(sectionId) {
  const section = SCHEMA.sections.find(s => s.id === sectionId);
  const newItem = {};
  section.fields.forEach(field => {
    newItem[field.id] = '';
  });
  formState[sectionId].push(newItem);
  renderApp();
}

function removeSectionItem(sectionId, index) {
  if (formState[sectionId]) {
    formState[sectionId].splice(index, 1);
    renderApp();
  }
}

function toggleSectionItem(sectionId, index) {
  const content = document.getElementById(`${sectionId}-content-${index}`);
  const toggle = document.getElementById(`${sectionId}-toggle-${index}`);
  if (content && toggle) {
    if (content.style.display === 'none') {
      content.style.display = 'block';
      toggle.textContent = 'â–¼';
    } else {
      content.style.display = 'none';
      toggle.textContent = 'â–¶';
    }
  }
}

// ====================
// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
// ====================
function validateForm() {
  const errors = [];
  const llmSection = SCHEMA.sections.find(s => s.id === 'llm');
  const currentCase = llmSection.conditional.cases[formState.provider];

  // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
  currentCase.fields.forEach(field => {
    if (field.required) {
      const value = formState.llmFields[field.id];
      if (!value || (typeof value === 'string' && value.trim() === '')) {
        errors.push({ field: field.id, message: `${field.label}ã¯å¿…é ˆã§ã™` });
      }
    }

    // æ•°å€¤ç¯„å›²ãƒã‚§ãƒƒã‚¯
    if (field.type === 'number') {
      const value = formState.llmFields[field.id];
      if (field.min !== undefined && value < field.min) {
        errors.push({ field: field.id, message: `${field.label}ã¯${field.min}ä»¥ä¸Šã«ã—ã¦ãã ã•ã„` });
      }
      if (field.max !== undefined && value > field.max) {
        errors.push({ field: field.id, message: `${field.label}ã¯${field.max}ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„` });
      }
    }
  });

  return errors;
}

function showValidationErrors(errors) {
  // æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
  document.querySelectorAll('[id^="error-"]').forEach(el => {
    el.classList.add('hidden');
    el.textContent = '';
  });

  // ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
  errors.forEach(error => {
    const errorEl = document.getElementById(`error-llm-${error.field}`);
    if (errorEl) {
      errorEl.textContent = error.message;
      errorEl.classList.remove('hidden');
    }
  });
}

// ====================
// è‡ªå‹•ç”Ÿæˆ
// ====================
function generateAutoValue(generator) {
  if (generator === 'timestamp_iso8601') {
    const now = new Date();
    const offset = -now.getTimezoneOffset();
    const offsetHours = Math.floor(Math.abs(offset) / 60).toString().padStart(2, '0');
    const offsetMinutes = (Math.abs(offset) % 60).toString().padStart(2, '0');
    const offsetSign = offset >= 0 ? '+' : '-';
    const tzString = `${offsetSign}${offsetHours}:${offsetMinutes}`;

    const year = now.getFullYear();
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const day = now.getDate().toString().padStart(2, '0');
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const seconds = now.getSeconds().toString().padStart(2, '0');

    return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}${tzString}`;
  }
  return '';
}

// ====================
// Markdownç”Ÿæˆ
// ====================
function generateMarkdown() {
  let md = `# ${SCHEMA.meta.outputTitle}\n\n`;

  SCHEMA.sections.forEach(section => {
    md += `## ${section.id}\n\n`;

    if (section.outputFormat === 'list') {
      if (section.fields) {
        // infoã‚»ã‚¯ã‚·ãƒ§ãƒ³
        section.fields.forEach(field => {
          let value;
          if (field.type === 'fixed') {
            value = field.value;
          } else if (field.type === 'auto') {
            value = generateAutoValue(field.generator);
          }
          md += `- ${field.id}: ${value}\n`;
        });
      } else if (section.conditional) {
        // llmã‚»ã‚¯ã‚·ãƒ§ãƒ³
        const currentCase = section.conditional.cases[formState.provider];
        currentCase.fields.forEach(field => {
          const value = formState.llmFields[field.id];

          if (field.type === 'array') {
            md += `- ${field.id}:\n`;
            if (Array.isArray(value)) {
              value.forEach(item => {
                if (item.trim()) {
                  md += `  - ${item}\n`;
                }
              });
            }
          } else {
            md += `- ${field.id}: ${value}\n`;
          }
        });
      }
    } else if (section.outputFormat === 'table') {
      // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆspecTypes ãªã©ï¼‰
      const headers = section.columns.map(col => col.id);
      const rows = formState[section.id] || [];

      md += `| ${headers.join(' | ')} |\n`;
      md += `|${headers.map(() => '------').join('|')}|\n`;

      rows.forEach(row => {
        const values = headers.map(h => escapeForTableCell(row[h]));
        md += `| ${values.join(' | ')} |\n`;
      });
    } else if (section.outputFormat === 'sections') {
      // ã‚»ã‚¯ã‚·ãƒ§ãƒ³å½¢å¼ï¼ˆsystemPrompts ãªã©ï¼‰
      const items = formState[section.id] || [];
      const itemKey = section.itemKey || 'name';

      items.forEach(item => {
        const itemName = item[itemKey] || 'åç§°æœªè¨­å®š';
        md += `### ${itemName}\n\n`;

        section.fields.forEach(field => {
          if (field.id === itemKey) return; // itemKeyã¯è¦‹å‡ºã—ã«ä½¿ç”¨æ¸ˆã¿
          const value = item[field.id] || '';
          md += `#### ${field.id}\n\n`;
          md += `${value}\n\n`;
        });
      });
    }

    md += '\n';
  });

  return md.trim() + '\n';
}

// ====================
// ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
// ====================
function downloadConfig() {
  const errors = validateForm();
  if (errors.length > 0) {
    showValidationErrors(errors);
    alert('å…¥åŠ›å†…å®¹ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚èµ¤å­—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    return;
  }

  const md = generateMarkdown();
  const blob = new Blob([md], { type: 'text/markdown;charset=utf-8' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = SCHEMA.meta.outputFileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// ====================
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
// ====================
document.addEventListener('DOMContentLoaded', init);
</script>

<div id="app"></div>

</body>
</html>
